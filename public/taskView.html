<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Quiz</title>
  <style>
    /* Button standardmäßig unsichtbar */
    #submitButton {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Programmierung-Quiz</h1>
  <div id="quizContainer">
    <h2 id="questionText"></h2>
    <div id="answerOptions"></div>
    <button id="submitButton" onclick="submitAnswer()">Antwort abschicken</button>
  </div>
  

  <script>
  const socket = io();

  // URL-Parameter auslesen
  const urlParams = new URLSearchParams(window.location.search);
  const userName = urlParams.get('name'); // Name des Benutzers aus der URL holen
  const userId = urlParams.get('userId'); // ID des Benutzers aus der URL holen
  
  // Neue Frage anzeigen
  socket.on("newTask", (task) => {
    document.getElementById("submitButton").style.display = "block";
    document.getElementById("questionText").textContent = task.description;

    const optionsContainer = document.getElementById("answerOptions");
    optionsContainer.innerHTML = ""; // Vorherige Antworten löschen

    if (task.type === "multipleChoice") {
      task.options.forEach((option) => {
        const button = document.createElement("button");
        button.textContent = option;
        button.onclick = () => selectAnswer(option);
        optionsContainer.appendChild(button);
      });
    } else if (task.type === "coding") {
      const editorContainer = document.createElement("textarea");
      editorContainer.id = "codeEditor";
      optionsContainer.appendChild(editorContainer);
    } else if (task.type === "text") {
      const textArea = document.createElement("textarea");
      textArea.id = "textAnswer";
      optionsContainer.appendChild(textArea);
    }
  });


  let selectedAnswer = null;

  function selectAnswer(answer) {
    selectedAnswer = answer;
  }

  function submitAnswer() {
    const taskId = 1; // Beispiel
    const userId = 123; // Beispiel
    if (selectedAnswer) {
      socket.emit("submitTask", { userId, taskId, answer: selectedAnswer });
    }
  }

  socket.on("quizCompleted", (results) => {
  alert("Das Quiz ist beendet!");
  // Ergebnisse anzeigen
  });

  // Benutzer beim Verlassen der Seite abmelden
  window.addEventListener("beforeunload", () => {
  socket.emit("disconnectUser", userId);
  });

  </script>
</body>
</html>
