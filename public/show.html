<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <title>Spielansicht</title>
    <link rel="stylesheet" href="/css/showStyle.css"> <!-- CSS-Datei einbinden -->
</head>

<body>
    <!-- Oberer Bereich -->
    <div class="questionText">
        <h1 id="questionText">Aufgabenanzeige</h1>
        <pre id="codeDisplay" style="display: none;"></pre>
    </div>

    <!-- Unterer Bereich -->
    <div class="bottom-section">
        <!-- Linker Bereich -->
        <div class="left-box">
            <p>Hier wird der Inhalt für andere Aufgaben angezeigt.</p>
        </div>

        <!-- Rechte Spalte -->
        <div class="right-box">
            <div class="timer">30 Sekunden</div>
            <div class="progress-bar">
                <div class="progress-bar-inner" id="progressBar"></div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        socket.on("newTask", (task) => {
            const questionText = document.getElementById("questionText");
            const codeDisplay = document.getElementById("codeDisplay");
            const questionTextContainer = document.querySelector(".questionText");
            questionTextContainer.style.backgroundColor = "#fff";


            // Setze die Fragebeschreibung
            questionText.textContent = task.description;

            // Prüfen, ob es Code gibt
            if (task.type === "output" || task.type === "coding") {
                // Code anzeigen und zentrierte Klasse entfernen
                codeDisplay.style.display = "block";
                codeDisplay.textContent = task.template;
                questionTextContainer.classList.add("code");
            } else {
                // Code ausblenden und zentrierte Klasse hinzufügen
                codeDisplay.style.display = "none";
                questionTextContainer.classList.remove("code");
            }
        });



        // Korrekte Lösung anzeigen
        socket.on("taskCompleted", (correctAnswer) => {
            const questionTextContainer = document.querySelector(".questionText");
            const codeDisplay = document.getElementById("codeDisplay");
            questionTextContainer.classList.remove("code");
            questionTextContainer.style.backgroundColor = "#d4edda";
            codeDisplay.style.display = "none";
            document.getElementById("questionText").textContent = `Korrekte Antwort: ${correctAnswer}`;
        });

        // Fortschrittsbalken
        let duration = 30;
        let currentProgress = 100;

        function updateProgressBar() {
            const progressBarInner = document.getElementById("progressBar");
            const timer = document.querySelector(".timer");

            const interval = setInterval(() => {
                if (currentProgress <= 0) {
                    clearInterval(interval);
                    timer.textContent = "Zeit abgelaufen!";
                } else {
                    currentProgress -= 100 / duration;
                    progressBarInner.style.height = `${currentProgress}%`;
                    timer.textContent = `${Math.ceil((duration * currentProgress) / 100)} Sekunden`;
                }
            }, 1000);
        }

        window.onload = updateProgressBar;
    </script>
</body>

</html>